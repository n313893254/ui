<section class="header clearfix">
  <div class="pull-left pt-10"><h1>{{t 'eventPage.header'}}</h1></div>
</section>
<section class="box mb-20">
  <div class="row">
    <div class="col span-1">
      <label class="acc-label">
        {{t 'eventPage.resourceKind'}}
      </label>
      {{searchable-select
        class="form-control"
        content=eventLogContent
        value=resourceKind
      }}
    </div>
    <div class="col span-2">
      <label class="acc-label">
        {{t 'eventPage.namespace'}}
      </label>
      {{searchable-select
        class="form-control"
        content=namespaceContent
        value=namespaceId
        readOnly=(eq resourceKind 'Node')
      }}
    </div>
    <div class="col span-3">
      <label class="acc-label">
        {{t 'eventPage.resourceName'}}
      </label>
      {{resource-search
          includeLocal=false
          principal=addInput
          selectExact="selectExact"
          selectExactOnBlur=selectExactOnBlur
          useLabel=true
          add="add"
          namespaceId=namespaceId
          resourceKind=resourceKind
          clusterId=clusterId
      }}
    </div>
    <div class="col span-2">
      <label class="acc-label">
        {{t 'eventPage.logLevel'}}
      </label>
      {{searchable-select
        class="form-control"
        content=eventLevelContent
        value=eventType
      }}
    </div>
    <div class="col span-2">
      <label class="acc-label">
        {{t 'eventPage.time'}}
      </label>
      {{searchable-select
        class="form-control"
        content=eventTimeContent
        value=eventTime
      }}
    </div>
    <div class="col span-2">
      <button class="btn bg-primary pull-right" {{action 'search'}} style="margin-top: 24px;">
        {{#if searching}}
          <i class="icon icon-spinner icon-spin"></i> Searching
        {{else}}
          Search
        {{/if}}
      </button>
    </div>
  </div>
  {{#if (eq eventTime 'custom')}}
    <div class="row">
      <div class="col span-4">
        <label class="acc-label">
          {{t 'eventPage.startTime'}}
        </label>
        {{#basic-dropdown as |dropdown|}}
          <input type="text"
            data-ebd-id="{{dropdown.uniqueId}}-trigger"
            class="datepicker-demo-input"
            onclick={{dropdown.actions.toggle}}
            value={{if startDate (date-str startDate format='YYYY-MM-DD')}}
            readonly>

          {{#dropdown.content class="datepicker-demo-dropdown"}}
            {{#power-calendar class="demo-calendar-small"
              center=month
              onCenterChange=(action (mut month) value="date")
              selected=startDate
              onSelect=(action (mut startDate) value="date") as |calendar|}}
              <nav class="ember-power-calendar-nav">
                <button type="button" class="ember-power-calendar-nav-control" onclick={{action calendar.actions.moveCenter -12 'month'}}>«</button>
                <button type="button" class="ember-power-calendar-nav-control" onclick={{action calendar.actions.moveCenter -1 'month'}}>‹</button>
                <div class="ember-power-calendar-nav-title">
                  {{format-date calendar.center 'MMMM YYYY'}}
                </div>
                <button class="ember-power-calendar-nav-control" onclick={{action calendar.actions.moveCenter 1 'month'}}>›</button>
                <button class="ember-power-calendar-nav-control" onclick={{action calendar.actions.moveCenter 12 'month'}}>»</button>
              </nav>
              {{calendar.days}}
            {{/power-calendar}}
          {{/dropdown.content}}
        {{/basic-dropdown}}
      </div>
      <div class="col span-4">
        <label class="acc-label">
          {{t 'eventPage.endTime'}}
        </label>
        {{#basic-dropdown as |dropdown|}}
          <input type="text"
            data-ebd-id="{{dropdown.uniqueId}}-trigger"
            class="datepicker-demo-input"
            onclick={{dropdown.actions.toggle}}
            value={{if endDate (date-str endDate format='YYYY-MM-DD')}}
            readonly>

          {{#dropdown.content class="datepicker-demo-dropdown"}}
            {{#power-calendar class="demo-calendar-small"
              center=month
              onCenterChange=(action (mut month) value="date")
              selected=endDate
              onSelect=(action (mut endDate) value="date") as |calendar|}}
              <nav class="ember-power-calendar-nav">
                <button type="button" class="ember-power-calendar-nav-control" onclick={{action calendar.actions.moveCenter -12 'month'}}>«</button>
                <button type="button" class="ember-power-calendar-nav-control" onclick={{action calendar.actions.moveCenter -1 'month'}}>‹</button>
                <div class="ember-power-calendar-nav-title">
                  {{format-date calendar.center 'MMMM YYYY'}}
                </div>
                <button class="ember-power-calendar-nav-control" onclick={{action calendar.actions.moveCenter 1 'month'}}>›</button>
                <button class="ember-power-calendar-nav-control" onclick={{action calendar.actions.moveCenter 12 'month'}}>»</button>
              </nav>
              {{calendar.days}}
            {{/power-calendar}}
          {{/dropdown.content}}
        {{/basic-dropdown}}
      </div>
    </div>
  {{/if}}
</section>

{{#sortable-table
  tableClassNames="bordered"
  paging=true
  pagingLabel="pagination.event"
  headers=headers
  bulkActions=false
  rowActions=false
  body=rows
  sortBy="created"
  search=false
  showHeader=false
  customer="event"
  descending=true
  as |sortable kind obj dt|
}}
  {{#if (eq kind "row")}}
    {{event/event-row
      model=obj
      toggle=(action "toggleExpand" obj.id)
      expanded=(array-includes expandedLogs obj.id)
      searchText=searchText
      subMatches=sortable.subMatches
      fullColspan=sortable.fullColspan
      dt=dt
    }}
  {{else if (eq kind "nomatch")}}
    <tr><td colspan="{{sortable.fullColspan}}" class="text-center text-muted lacsso pt-20 pb-20">{{t 'persistentVolumePage.noMatch'}}</td></tr>
  {{else if (eq kind "norows")}}
    <tr><td colspan="{{sortable.fullColspan}}" class="text-center text-muted lacsso pt-20 pb-20">No data</td></tr>
  {{/if}}
{{/sortable-table}}

<section class="mt-20">
  <div class="text-center">
    <button class="btn btn-sm bg-primary" {{action "loadMore"}} >
      {{#if loading}}
        <i class="icon icon-spinner icon-spin"></i> Loading
      {{else}}
        Load More
      {{/if}}
    </button>
  </div>
</section>
